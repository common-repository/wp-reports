String.prototype.replaceAll=function(e){var t=this;for(var a in e)t=t.replace(new RegExp(a,"g"),e[a]);return t},NProgress.configure({parent:".report-area"}),jQuery.noConflict(),function(e){e(function(){e(document).ready(function(){DS_WP_Reports=DS_WP_Reports||{},DS_WP_Reports.chart=null,DS_WP_Reports.dateFormat="YYYY-MM-DD",DS_WP_Reports.dateRanges,DS_WP_Reports.lastReportItemClicked,DS_WP_Reports.buildLoader=function(){for(var e='<div class="loading-indicator">',t=1;t<6;t++)e+='<div class="rect'+t+'"></div>';return e+="</div>"},DS_WP_Reports.stretchCanvas=function(t){var a=e("#"+t),r=a.parent().innerWidth();a.attr({width:r-20+"px"})},DS_WP_Reports.switchReport=function(t){if(e(t).hasClass("disabled"))return!1;var a=e(t).data("report-id");return DS_WP_Reports.lastReportItemClicked=e(t),e(t).closest("li").append(DS_WP_Reports.buildLoader()),NProgress.start(),DS_WP_Reports.lastReportItemClicked.closest("ul").find("a").addClass("disabled"),e.post(DS_WP_Reports.ajax_url,{action:DS_WP_Reports.action_get_report_setup,report_id:a},DS_WP_Reports.onReportSetupLoaded).fail(DS_WP_Reports.onReportSetupFailed),!1},DS_WP_Reports.onReportDataLoaded=function(t,a,r){if(!0===t.success){DS_WP_Reports.initExportButton();var o=e(".report-content");if(e(".highlights").remove(),e(".no-data-notice").remove(),t.data.highlights){var s='<div class="row highlights">',n=0;for(var i in t.data.highlights){var l=t.data.highlights[i];s+='<div class="col-md-2 col-sm-4 col-xs-6 highlight-item">',s+='<span class="title">'+l.title+"</span>";var d=DS_WP_Reports.getChartColor(n++);s+='<div class="value" style="color: '+d+';">'+l.value+"</div>",s+='<span class="description">'+l.description+"</span>",s+="</div>\x3c!-- /.highlight --\x3e"}s+="</div>\x3c!-- /.highlights --\x3e",e(s).insertBefore(o.closest(".row"))}var p=t.data.values.length>0;if("timeline"===t.data.visualization){null!==DS_WP_Reports.chart&&(DS_WP_Reports.chart.destroy(),o.find("#ds-wp-reports-chart").remove()),o.append('<canvas id="ds-wp-reports-chart" width="100%" height="300"></canvas>'),DS_WP_Reports.stretchCanvas("ds-wp-reports-chart");var c=new Array,_=!1,u=[],v=0;for(var f in t.data.labels){var g=new Array;for(var m in t.data.values){var h=t.data.values[m];_||c.push(m);for(var R in h)R===f&&g.push(h[R])}_=!0;var d=DS_WP_Reports.getChartColor(v);u.push({label:t.data.labels[f],backgroundColor:d,borderColor:d,data:g,fill:!1}),v++}var D=e("#ds-wp-reports-chart").get(0).getContext("2d");DS_WP_Reports.chart=new Chart(D,{type:"line",data:{labels:c,datasets:u},options:{responsive:!0,tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0}}})}else if("tabular"===t.data.visualization)if(p){var P=o.find(".report-table");if(0===P.length){var S='<table class="table table-bordered report-table">';S+="<thead>";for(var W in t.data.labels)S+='<th data-dynatable-column="'+W+'">'+t.data.labels[W]+"</th>";S+="</thead>",S+="<tbody>",S+="</body>",S+="</table>",o.append(S)}for(var g=new Array,b=t.data.values.length,m=0;m<b;m++)g.push(t.data.values[m]);if(0===P.length)e(".report-table").bind("dynatable:init",function(e,t){t.$element.width()>t.$element.closest(".report-content").width()?t.$element.addClass("too-wide"):t.$element.removeClass("too-wide")}).dynatable({features:{pushState:!1,sort:!1,search:!1,perPageSelect:!1},dataset:{records:g,perPageDefault:50}});else{var w=P.data("dynatable");w.records.updateFromJson(g),w.records.init(),w.settings.dataset.originalRecords=g,w.process()}}else o.empty();p||o.append('<p class="no-data-notice">No data available for current selection.</p>')}},DS_WP_Reports.getChartColor=function(e){var t=["#2ecc71","#e74c3c","#8e44ad","#f39c12","#3498db","#2c3e50"];return t[e%t.length]},DS_WP_Reports.toggleFilters=function(){return e(".filters-area").toggle(),!1},DS_WP_Reports.onReportSetupLoaded=function(t,a,r){if(!0===t.success){var o=t.data,s=e(".report-area");s.empty();var n='<div class="row top-bar">';n+='<div class="col-md-6">',n+='<h3 class="title">'+o.name+"</h3>",n+="</div>",n+='<div class="col-md-6">',n+='<div id="daterange" class="pull-right">',n+='<i class="glyphicon glyphicon-calendar fa fa-calendar"></i>&nbsp;',n+='<span></span> <b class="caret"></b>',n+="</div>\x3c!-- /#daterange --\x3e",n+='<a href="#" class="pull-right filter-toggle export-button">',n+='<i class="glyphicon glyphicon-download-alt"></i>&nbsp;Export',n+="</a>";o.filters&&o.filters.length&&(n+='<a href="#" class="pull-right filter-toggle" onclick="return DS_WP_Reports.toggleFilters();">',n+='<i class="glyphicon glyphicon-filter"></i>&nbsp;Filter',n+="</a>"),n+="</div>",n+="</div>",n+='<form class="row report-options">',n+='<input type="hidden" name="report_id" value="'+o.report_id+'" />',n+='<input type="hidden" name="visualization" value="'+o.suitable_visualizations[0]+'" />',n+='<div class="col-xs-12 filters-area">';var i="";for(var l in o.filters){var d=o.filters[l],p=d.label,c="filter_"+d.filter_id;p&&(i+='<label for="'+c+'" style="width: 100%;">'+p),i+='<select class="form-control" name="'+d.filter_id+'[]" id="'+c+'" multiple="multiple" style="width: 100%;">';for(var _ in d.values){i+='<option value="'+_+'">'+d.values[_]+"</option>"}i+="</select>",p&&(i+="</label>")}n+=i,n+="</div>",n+='<input type="hidden" name="date_from" value="" />',n+='<input type="hidden" name="date_to" value="" />',n+="</form>",n+='<div class="row">',n+='<div class="col-xs12 report-content"></div>',n+="</div>",n+="</div>\x3c!-- /.row --\x3e",s.append(n);var u=s.find("form.report-options");u.on("submit",DS_WP_Reports.submitReportOptionsForm),DS_WP_Reports.initializeDaterangePicker(),u.find("select").select2(),u.find("select").on("change",function(e){u.trigger("submit")}),e(".report-area").find("form.report-options").trigger("submit")}DS_WP_Reports.lastReportItemClicked.closest("ul").find("li").removeClass("active"),DS_WP_Reports.lastReportItemClicked.closest("li").addClass("active"),DS_WP_Reports.lastReportItemClicked.closest("li").find(".loading-indicator").remove(),DS_WP_Reports.lastReportItemClicked.closest("ul").find("a.disabled").removeClass("disabled"),NProgress.done()},DS_WP_Reports.submitReportOptionsForm=function(){var t=e(this),a="action="+DS_WP_Reports.action_get_report_data+"&"+t.serialize();return e.post(DS_WP_Reports.ajax_url,a,DS_WP_Reports.onReportDataLoaded).fail(DS_WP_Reports.onReportDataLoadFailed),!1},DS_WP_Reports.initExportButton=function(){var t=e(".export-button");t.click(function(){DS_WP_Reports.exportButtonOnClickAction(t)})},DS_WP_Reports.exportButtonOnClickAction=function(){var t=e(".report-area"),a=t.find("form.report-options"),r=a.serialize()+"&export=csv",o="?action="+DS_WP_Reports.action_get_report_data+"&"+r;window.location=DS_WP_Reports.ajax_url+o},DS_WP_Reports.getDateRanges=function(e){void 0===DS_WP_Reports.dateRanges&&(DS_WP_Reports.dateRanges={last_7_days:{label:DS_WP_Reports.last_x_days.replaceAll({"%%count%%":7}),start:moment().subtract(7,"days"),end:moment()},last_30_days:{label:DS_WP_Reports.last_x_days.replaceAll({"%%count%%":30}),start:moment().subtract(30,"days"),end:moment()},this_month:{label:DS_WP_Reports.this_month,start:moment().startOf("month"),end:moment()},last_month:{label:DS_WP_Reports.last_month,start:moment().startOf("month").subtract(1,"days").startOf("month"),end:moment().startOf("month").subtract(1,"days")}});var t=DS_WP_Reports.dateRanges;if(!e)return t;var a={};for(var r in t){var o=t[r];a[o.label]=[o.start,o.end]}return a},DS_WP_Reports.getPredefinedDateRangeIdByLabel=function(e){var t=DS_WP_Reports.getDateRanges();for(var a in t){if(e===t[a].label)return a}return null},DS_WP_Reports.getPredefinedDateRangeById=function(e){var t=DS_WP_Reports.getDateRanges();for(var a in t)if(e===a)return t[a];return null},DS_WP_Reports.initializeDaterangePicker=function(){var t=moment().subtract(31,"days"),a=moment().subtract(1,"days"),r=Cookies.get("ds-wpr-start-date");void 0!==r&&(t=moment(""+r));var o=Cookies.get("ds-wpr-end-date");void 0!==o&&(a=moment(""+o));var s=Cookies.get("ds-wpr-range");if(void 0!==s){var n=DS_WP_Reports.getPredefinedDateRangeById(s);null!==n&&(t=n.start,a=n.end)}e("#daterange").daterangepicker({showDropdowns:!0,showWeekNumbers:!0,locale:{format:DS_WP_Reports.dateFormat},startDate:t,endDate:a,ranges:DS_WP_Reports.getDateRanges(!0),alwaysShowCalendars:!0,opens:"left"},function(t,a,r){DS_WP_Reports.onDateRangeChanged(t,a,r),e(".report-area").find("form.report-options").trigger("submit")}),DS_WP_Reports.onDateRangeChanged(t,a,"__init__")},DS_WP_Reports.onDateRangeChanged=function(t,a,r){var o=t.format(DS_WP_Reports.dateFormat),s=a.format(DS_WP_Reports.dateFormat);if("__init__"!==r){var n=DS_WP_Reports.getPredefinedDateRangeIdByLabel(r);null!==n?(Cookies.set("ds-wpr-range",n,{expires:365,path:"/",domain:window.location.hostname}),Cookies.remove("ds-wpr-start-date"),Cookies.remove("ds-wpr-end-date")):(Cookies.set("ds-wpr-start-date",o,{expires:365,path:"/",domain:window.location.hostname}),Cookies.set("ds-wpr-end-date",s,{expires:365,path:"/",domain:window.location.hostname}),Cookies.remove("ds-wpr-range"))}e("#daterange span").html(o+" - "+s),e(".report-area").find("form.report-options input[name=date_from]").val(o),e(".report-area").find("form.report-options input[name=date_to]").val(s)},DS_WP_Reports.onReportDataLoadFailed=function(e,t,a){},DS_WP_Reports.onReportSetupFailed=function(e,t,a){}})})}(jQuery);